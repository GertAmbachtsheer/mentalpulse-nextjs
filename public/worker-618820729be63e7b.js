(()=>{"use strict";let i=self;i.addEventListener("push",t=>{let e=t.data?.json()??{},n=e.title||"MentalPulse Alert",o={body:e.body||"You have a new notification",icon:e.icon||"/icon512_rounded.png",badge:e.badge||"/icon512_rounded.png",data:e.data||{},requireInteraction:e.requireInteraction??!0,actions:[]};e.data?.type==="panic-alert"?o.actions=[{action:"respond",title:"\uD83D\uDC9A Respond"},{action:"decline",title:"Dismiss"}]:e.data?.type==="panic-response"?o.actions=[{action:"view",title:"View"},{action:"close",title:"Dismiss"}]:o.actions=[{action:"view",title:"View Details"},{action:"close",title:"Dismiss"}],t.waitUntil(i.registration.showNotification(n,o))}),i.addEventListener("notificationclick",t=>{console.log("[SW] Notification clicked:",t.action,t.notification.data),t.notification.close();let e=t.action,n=t.notification.data;if("respond"===e&&n?.type==="panic-alert")t.waitUntil((async()=>{try{for(let t of(await i.clients.matchAll({type:"window",includeUncontrolled:!0})))if(t.url.includes(i.location.origin)&&"focus"in t)return t.postMessage({type:"NOTIFICATION_CLICK",action:"respond",alertId:n.alertId,triggerUserId:n.triggerUserId}),t.focus();if(i.clients.openWindow)return i.clients.openWindow(`/?respondToAlert=${n.alertId}`)}catch(i){console.error("[SW] Error handling respond action:",i)}})());else{if("decline"===e||"close"===e)return;t.waitUntil(i.clients.matchAll({type:"window",includeUncontrolled:!0}).then(t=>{for(let e of t)if(e.url.includes(i.location.origin)&&"focus"in e)return e.focus();if(i.clients.openWindow)return i.clients.openWindow("/")}))}})})();